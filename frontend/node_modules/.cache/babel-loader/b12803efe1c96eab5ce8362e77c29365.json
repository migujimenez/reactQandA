{"ast":null,"code":"import _regeneratorRuntime from\"C:/MyApps/reactQandA/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/MyApps/reactQandA/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/MyApps/reactQandA/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import createAuth0Client from'@auth0/auth0-spa-js';import{authSettings}from'./AppSettings';import{jsx as _jsx}from\"react/jsx-runtime\";export var Auth0Context=/*#__PURE__*/React.createContext({isAuthenticated:false,signIn:function signIn(){},signOut:function signOut(){},loading:true});export var useAuth=function useAuth(){return React.useContext(Auth0Context);};export var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isAuthenticated=_React$useState2[0],setIsAuthenticated=_React$useState2[1];var _React$useState3=React.useState(undefined),_React$useState4=_slicedToArray(_React$useState3,2),user=_React$useState4[0],setUser=_React$useState4[1];var _React$useState5=React.useState(),_React$useState6=_slicedToArray(_React$useState5,2),auth0Client=_React$useState6[0],setAuth0Client=_React$useState6[1];var _React$useState7=React.useState(true),_React$useState8=_slicedToArray(_React$useState7,2),loading=_React$useState8[0],setLoading=_React$useState8[1];React.useEffect(function(){var initAuth0=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var auth0FromHook,isAuthenticatedFromHook,_user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);_context.next=3;return createAuth0Client(authSettings);case 3:auth0FromHook=_context.sent;setAuth0Client(auth0FromHook);if(!(window.location.pathname==='/signin-callback'&&window.location.search.indexOf('code=')>-1)){_context.next=9;break;}_context.next=8;return auth0FromHook.handleRedirectCallback();case 8:window.location.replace(window.location.origin);case 9:_context.next=11;return auth0FromHook.isAuthenticated();case 11:isAuthenticatedFromHook=_context.sent;if(!isAuthenticatedFromHook){_context.next=17;break;}_context.next=15;return auth0FromHook.getUser();case 15:_user=_context.sent;setUser(_user);case 17:setIsAuthenticated(isAuthenticatedFromHook);setLoading(false);case 19:case\"end\":return _context.stop();}}},_callee);}));return function initAuth0(){return _ref2.apply(this,arguments);};}();initAuth0();},[]);var getAuth0ClientFromState=function getAuth0ClientFromState(){if(auth0Client===undefined){throw new Error('Auth0 client not set');}return auth0Client;};return/*#__PURE__*/_jsx(Auth0Context.Provider,{value:{isAuthenticated:isAuthenticated,user:user,signIn:function signIn(){return getAuth0ClientFromState().loginWithRedirect();},signOut:function signOut(){return getAuth0ClientFromState().logout({client_id:authSettings.client_id,returnTo:window.location.origin+'/signout-callback'});},loading:loading},children:children});};export var getAccessToken=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var auth0FromHook,accessToken;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return createAuth0Client(authSettings);case 2:auth0FromHook=_context2.sent;_context2.next=5;return auth0FromHook.getTokenSilently();case 5:accessToken=_context2.sent;return _context2.abrupt(\"return\",accessToken);case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function getAccessToken(){return _ref3.apply(this,arguments);};}();","map":{"version":3,"sources":["C:/MyApps/reactQandA/frontend/src/Auth.tsx"],"names":["React","createAuth0Client","authSettings","Auth0Context","createContext","isAuthenticated","signIn","signOut","loading","useAuth","useContext","AuthProvider","children","useState","setIsAuthenticated","undefined","user","setUser","auth0Client","setAuth0Client","setLoading","useEffect","initAuth0","auth0FromHook","window","location","pathname","search","indexOf","handleRedirectCallback","replace","origin","isAuthenticatedFromHook","getUser","getAuth0ClientFromState","Error","loginWithRedirect","logout","client_id","returnTo","getAccessToken","getTokenSilently","accessToken"],"mappings":"ybAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,iBAAP,KAA+C,qBAA/C,CACA,OAASC,YAAT,KAA6B,eAA7B,C,2CAaA,MAAO,IAAMC,CAAAA,YAAY,cAAGH,KAAK,CAACI,aAAN,CAAmC,CAC7DC,eAAe,CAAE,KAD4C,CAE7DC,MAAM,CAAE,iBAAM,CAAE,CAF6C,CAG7DC,OAAO,CAAE,kBAAM,CAAE,CAH4C,CAI7DC,OAAO,CAAE,IAJoD,CAAnC,CAArB,CAOP,MAAO,IAAMC,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,SAAMT,CAAAA,KAAK,CAACU,UAAN,CAAiBP,YAAjB,CAAN,EAAhB,CAEP,MAAO,IAAMQ,CAAAA,YAAsB,CAAG,QAAzBA,CAAAA,YAAyB,MAAkB,IAAfC,CAAAA,QAAe,MAAfA,QAAe,CACtD,oBAA8CZ,KAAK,CAACa,QAAN,CAAwB,KAAxB,CAA9C,oDAAOR,eAAP,qBAAwBS,kBAAxB,qBACA,qBAAwBd,KAAK,CAACa,QAAN,CAAsCE,SAAtC,CAAxB,qDAAOC,IAAP,qBAAaC,OAAb,qBACA,qBAAsCjB,KAAK,CAACa,QAAN,EAAtC,qDAAOK,WAAP,qBAAoBC,cAApB,qBACA,qBAA8BnB,KAAK,CAACa,QAAN,CAAwB,IAAxB,CAA9B,qDAAOL,OAAP,qBAAgBY,UAAhB,qBAEApB,KAAK,CAACqB,SAAN,CAAgB,UAAM,CACpB,GAAMC,CAAAA,SAAS,2FAAG,mLAChBF,UAAU,CAAC,IAAD,CAAV,CADgB,sBAEYnB,CAAAA,iBAAiB,CAACC,YAAD,CAF7B,QAEVqB,aAFU,eAGhBJ,cAAc,CAACI,aAAD,CAAd,CAHgB,KAMdC,MAAM,CAACC,QAAP,CAAgBC,QAAhB,GAA6B,kBAA7B,EACAF,MAAM,CAACC,QAAP,CAAgBE,MAAhB,CAAuBC,OAAvB,CAA+B,OAA/B,EAA0C,CAAC,CAP7B,gDASRL,CAAAA,aAAa,CAACM,sBAAd,EATQ,QAUdL,MAAM,CAACC,QAAP,CAAgBK,OAAhB,CAAwBN,MAAM,CAACC,QAAP,CAAgBM,MAAxC,EAVc,8BAasBR,CAAAA,aAAa,CAAClB,eAAd,EAbtB,SAaV2B,uBAbU,mBAcZA,uBAdY,iDAeKT,CAAAA,aAAa,CAACU,OAAd,EAfL,SAeRjB,KAfQ,eAgBdC,OAAO,CAACD,KAAD,CAAP,CAhBc,QAkBhBF,kBAAkB,CAACkB,uBAAD,CAAlB,CACAZ,UAAU,CAAC,KAAD,CAAV,CAnBgB,uDAAH,kBAATE,CAAAA,SAAS,2CAAf,CAqBAA,SAAS,GACV,CAvBD,CAuBG,EAvBH,EAyBA,GAAMY,CAAAA,uBAAuB,CAAG,QAA1BA,CAAAA,uBAA0B,EAAM,CACpC,GAAIhB,WAAW,GAAKH,SAApB,CAA+B,CAC7B,KAAM,IAAIoB,CAAAA,KAAJ,CAAU,sBAAV,CAAN,CACD,CACD,MAAOjB,CAAAA,WAAP,CACD,CALD,CAOA,mBACE,KAAC,YAAD,CAAc,QAAd,EACE,KAAK,CAAE,CACLb,eAAe,CAAfA,eADK,CAELW,IAAI,CAAJA,IAFK,CAGLV,MAAM,CAAE,wBAAM4B,CAAAA,uBAAuB,GAAGE,iBAA1B,EAAN,EAHH,CAIL7B,OAAO,CAAE,yBACP2B,CAAAA,uBAAuB,GAAGG,MAA1B,CAAiC,CAC/BC,SAAS,CAAEpC,YAAY,CAACoC,SADO,CAE/BC,QAAQ,CAAEf,MAAM,CAACC,QAAP,CAAgBM,MAAhB,CAAyB,mBAFJ,CAAjC,CADO,EAJJ,CASLvB,OAAO,CAAPA,OATK,CADT,UAaGI,QAbH,EADF,CAiBD,CAvDM,CAyDP,MAAO,IAAM4B,CAAAA,cAAc,2FAAG,6LACAvC,CAAAA,iBAAiB,CAACC,YAAD,CADjB,QACtBqB,aADsB,uCAEFA,CAAAA,aAAa,CAACkB,gBAAd,EAFE,QAEtBC,WAFsB,iDAGrBA,WAHqB,0DAAH,kBAAdF,CAAAA,cAAc,2CAApB","sourcesContent":["import React from 'react';\r\nimport createAuth0Client, { Auth0Client } from '@auth0/auth0-spa-js';\r\nimport { authSettings } from './AppSettings';\r\n\r\ninterface Auth0User {\r\n  name?: string;\r\n  email?: string;\r\n}\r\ninterface IAuth0Context {\r\n  isAuthenticated: boolean;\r\n  user?: Auth0User;\r\n  signIn: () => void;\r\n  signOut: () => void;\r\n  loading: boolean;\r\n}\r\nexport const Auth0Context = React.createContext<IAuth0Context>({\r\n  isAuthenticated: false,\r\n  signIn: () => {},\r\n  signOut: () => {},\r\n  loading: true,\r\n});\r\n\r\nexport const useAuth = () => React.useContext(Auth0Context);\r\n\r\nexport const AuthProvider: React.FC = ({ children }) => {\r\n  const [isAuthenticated, setIsAuthenticated] = React.useState<boolean>(false);\r\n  const [user, setUser] = React.useState<Auth0User | undefined>(undefined);\r\n  const [auth0Client, setAuth0Client] = React.useState<Auth0Client>();\r\n  const [loading, setLoading] = React.useState<boolean>(true);\r\n\r\n  React.useEffect(() => {\r\n    const initAuth0 = async () => {\r\n      setLoading(true);\r\n      const auth0FromHook = await createAuth0Client(authSettings);\r\n      setAuth0Client(auth0FromHook);\r\n\r\n      if (\r\n        window.location.pathname === '/signin-callback' &&\r\n        window.location.search.indexOf('code=') > -1\r\n      ) {\r\n        await auth0FromHook.handleRedirectCallback();\r\n        window.location.replace(window.location.origin);\r\n      }\r\n\r\n      const isAuthenticatedFromHook = await auth0FromHook.isAuthenticated();\r\n      if (isAuthenticatedFromHook) {\r\n        const user = await auth0FromHook.getUser();\r\n        setUser(user);\r\n      }\r\n      setIsAuthenticated(isAuthenticatedFromHook);\r\n      setLoading(false);\r\n    };\r\n    initAuth0();\r\n  }, []);\r\n\r\n  const getAuth0ClientFromState = () => {\r\n    if (auth0Client === undefined) {\r\n      throw new Error('Auth0 client not set');\r\n    }\r\n    return auth0Client;\r\n  };\r\n\r\n  return (\r\n    <Auth0Context.Provider\r\n      value={{\r\n        isAuthenticated,\r\n        user,\r\n        signIn: () => getAuth0ClientFromState().loginWithRedirect(),\r\n        signOut: () =>\r\n          getAuth0ClientFromState().logout({\r\n            client_id: authSettings.client_id,\r\n            returnTo: window.location.origin + '/signout-callback',\r\n          }),\r\n        loading,\r\n      }}\r\n    >\r\n      {children}\r\n    </Auth0Context.Provider>\r\n  );\r\n};\r\n\r\nexport const getAccessToken = async () => {\r\n  const auth0FromHook = await createAuth0Client(authSettings);\r\n  const accessToken = await auth0FromHook.getTokenSilently();\r\n  return accessToken;\r\n};\r\n"]},"metadata":{},"sourceType":"module"}